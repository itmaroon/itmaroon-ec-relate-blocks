(()=>{"use strict";var e,t={945(e,t,l){const a=window.wp.i18n,r=window.wp.blocks,o=window.React;function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var a in l)({}).hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},n.apply(null,arguments)}var i=function(e){return o.createElement("svg",n({xmlns:"http://www.w3.org/2000/svg",width:100,height:100,viewBox:"0 0 75 75"},e),o.createElement("path",{d:"M0 0h75v75H0z",style:{fill:"#fff",fillOpacity:1,stroke:"none"}}),o.createElement("path",{d:"M0 0h75v75H0z",style:{fill:"#fff",fillOpacity:1,stroke:"none"}}),o.createElement("path",{d:"M52.305 20.09a2.62 2.62 0 0 1-2.614 2.613 2.62 2.62 0 0 1-2.609-2.613v-5.223c0-5.289-4.293-9.582-9.582-9.582s-9.582 4.293-9.582 9.582v5.223a2.62 2.62 0 0 1-2.61 2.613 2.62 2.62 0 0 1-2.613-2.613v-5.223C22.695 6.691 29.32.063 37.5.063S52.305 6.69 52.305 14.867Zm0 0",style:{stroke:"none",fillRule:"evenodd",fill:"#000",fillOpacity:1}}),o.createElement("path",{d:"m63.063 24.793 2.789 41.785a7.86 7.86 0 0 1-2.086 5.879 7.87 7.87 0 0 1-5.73 2.48H16.964a7.87 7.87 0 0 1-5.73-2.48 7.8 7.8 0 0 1-2.087-5.879l2.79-41.785a7.837 7.837 0 0 1 7.82-7.313h35.5c4.113 0 7.527 3.2 7.804 7.313m-16.91 8.113a9.58 9.58 0 0 1-8.653 5.469 9.58 9.58 0 0 1-8.652-5.469 2.6 2.6 0 0 0-3.477-1.242 2.605 2.605 0 0 0-1.238 3.477c2.367 4.996 7.472 8.457 13.367 8.457s11-3.461 13.367-8.457a2.605 2.605 0 0 0-1.238-3.477 2.607 2.607 0 0 0-3.477 1.242m0 0",style:{stroke:"none",fillRule:"evenodd",fill:"#000",fillOpacity:1}}))};const s=window.wp.apiFetch;var c=l.n(s);const u=window.wp.components,d=window.ReactJSXRuntime,m=({fieldType:e,selectedFields:t,setSelectedFields:l})=>{const r=[{key:"title",label:(0,a.__)("Title","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"description",label:(0,a.__)("Description (plain)","itmaroon-ec-relate-blocks"),block:"core/paragraph"},{key:"descriptionHtml",label:(0,a.__)("Description (HTML)","itmaroon-ec-relate-blocks"),block:"core/paragraph"},{key:"vendor",label:(0,a.__)("Vendor","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"productType",label:(0,a.__)("Product Type","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"handle",label:(0,a.__)("Handle (Slug)","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"tags",label:(0,a.__)("Tags","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"availableForSale",label:(0,a.__)("Available for Sale","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"quantityAvailable",label:(0,a.__)("Quantity Available","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"price",label:(0,a.__)("Price","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"compareAtPrice",label:(0,a.__)("Compare at Price (Original)","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"currencyCode",label:(0,a.__)("Currency Code","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"image",label:(0,a.__)("Main Image","itmaroon-ec-relate-blocks"),block:"core/image"},{key:"images",label:(0,a.__)("All Images","itmaroon-ec-relate-blocks"),block:"itmar/slide-mv"},{key:"variants",label:(0,a.__)("Variants (Options)","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"sku",label:(0,a.__)("SKU","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"onlineStoreUrl",label:(0,a.__)("Online Store URL","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"createdAt",label:(0,a.__)("Created At","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"updatedAt",label:(0,a.__)("Updated At","itmaroon-ec-relate-blocks"),block:"itmar/design-title"}],o=[{key:"title",label:(0,a.__)("Title","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"featuredImage",label:(0,a.__)("Featured Image","itmaroon-ec-relate-blocks"),block:"core/image"},{key:"variants",label:(0,a.__)("Variants (Options)","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"quantity",label:(0,a.__)("Quantity","itmaroon-ec-relate-blocks"),block:"itmar/design-text-ctrl"},{key:"quantityAvailable",label:(0,a.__)("Quantity Available","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"price",label:(0,a.__)("Price","itmaroon-ec-relate-blocks"),block:"itmar/design-title"},{key:"compareAtPrice",label:(0,a.__)("Compare at Price (Original)","itmaroon-ec-relate-blocks"),block:"itmar/design-title"}],n="product"===e?r:o;return(0,d.jsx)(u.PanelBody,{title:(0,a.__)("Display Fields","itmaroon-ec-relate-blocks"),initialOpen:!0,children:n.map(e=>{return(0,d.jsx)("div",{className:"field_section",children:(0,d.jsx)(u.ToggleControl,{className:"field_choice",label:e.label,checked:(a=e.key,t.some(e=>e.key===a)),onChange:a=>((e,a,r,o)=>{a?t.some(t=>t.key===e)||l([...t,{key:e,label:r,block:o}]):l(t.filter(t=>t.key!==e))})(e.key,a,e.label,e.block)})},e.key);var a})})},b=window.wp.blockEditor,k=window.wp.element,p=window.wp.data;function _(e,t,l,a,r,o,n){try{var i=e[o](n),s=i.value}catch(e){return void l(e)}i.done?t(s):Promise.resolve(s).then(a,r)}function v(e){return function(){var t=this,l=arguments;return new Promise(function(a,r){var o=e.apply(t,l);function n(e){_(o,a,r,n,i,"next",e)}function i(e){_(o,a,r,n,i,"throw",e)}n(void 0)})}}function g(e,t,l){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var a=l.call(e,t);if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var a in l)({}).hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e},h.apply(null,arguments)}function f(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,a)}return l}function y(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?f(Object(l),!0).forEach(function(t){g(e,t,l[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):f(Object(l)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))})}return e}var w=e=>e.reduce((e,t)=>(e.push(t),t.innerBlocks&&t.innerBlocks.length>0&&e.push(...w(t.innerBlocks)),e),[]),x=e=>({blockName:e.name,attributes:e.attributes,innerBlocks:e.innerBlocks.length>0?e.innerBlocks.map(x):[]}),j=e=>{var t=Array.isArray(e.innerBlocks)?e.innerBlocks.map(j):[];return(0,r.createBlock)(e.blockName,e.attributes,t)};window.wp.url;var O=e=>{var{selectedSlug:t,label:l,homeUrl:a,fetchOptions:r}=e,[o,n]=(0,k.useState)([]);(0,k.useEffect)(()=>{var t=function(){var t=v(function*(){try{var t=yield r(a,e);n(t)}catch(e){console.error("Error fetching data:",e.message)}});return function(){return t.apply(this,arguments)}}();t()},[r,a,e.restBase,e.status,e.perPage,e.orderby,e.order,e.search]);var i=o.find(e=>e.slug===t);return React.createElement(u.ComboboxControl,{label:l,options:o,value:i?i.value:-1,onChange:t=>{var l=o.find(e=>e.value===t);e.onChange(l)}})},B=function(){var e=v(function*(e){var t=yield c()({path:"/wp/v2/types"}),l=0;return Object.keys(t).reduce((a,r)=>{var o=t[r];return!0===o.has_archive?a.push({value:l++,slug:o.slug,rest_base:o.rest_base,link:"".concat(e,"/").concat(o.slug),label:o.name}):"string"==typeof o.has_archive&&a.push({value:l++,slug:o.slug,rest_base:o.rest_base,link:"".concat(e,"/").concat(o.has_archive),label:o.name}),a},[])});return function(t){return e.apply(this,arguments)}}(),C=e=>React.createElement(O,h({},e,{fetchOptions:B}));const P=JSON.parse('{"UU":"itmar/product-block"}');(0,r.registerBlockType)(P.UU,{icon:(0,d.jsx)(i,{}),description:(0,a.__)("We provide blocks to build EC sites in cooperation with various EC companies.","itmaroon-ec-relate-blocks"),edit:function({attributes:e,setAttributes:t,clientId:l}){const{pickupId:o,productPost:n,storeUrl:i,shopId:s,channelName:_,categoryArray:v,headlessId:g,apiSecretMask:h,adminTokenMask:f,storefrontTokenMask:O,callbackUrl:B,stripeKey:P,selectedFields:S,numberOfItems:A,blocksAttributesArray:T}=e,{replaceInnerBlocks:I}=(0,p.useDispatch)("core/block-editor"),N=[(0,a.__)("For landscape images, odd numbers","itmaroon-ec-relate-blocks"),(0,a.__)("For landscape images, even numbers","itmaroon-ec-relate-blocks"),(0,a.__)("For portrait images, odd numbers","itmaroon-ec-relate-blocks"),(0,a.__)("For portrait images, even numbers","itmaroon-ec-relate-blocks")],E=(0,b.useBlockProps)(),F=(0,b.useInnerBlocksProps)(E,{allowedBlocks:["itmar/design-group","itmar/design-title","core/image","core/paragraph","itmar/design-button"],template:[],templateLock:!1}),{innerBlocks:U,parentBlock:D}=(0,p.useSelect)(e=>{const{getBlocks:t,getBlockParents:a,getBlock:r}=e("core/block-editor"),o=a(l);return{innerBlocks:t(l),parentBlock:o.length>0?r(o[o.length-1]):null}},[l]),M=(0,k.useMemo)(()=>[],[]),R="itmar/slide-mv"===D?.name?"div":"form",H="itmar/slide-mv"===D?.name?parentId:l;((e,t,l,a,o,n,i,s,c)=>{var{replaceInnerBlocks:u}=(0,p.useDispatch)("core/block-editor"),d=(0,p.useSelect)(e=>e("core/block-editor").getBlock(i),[i]);(0,k.useEffect)(()=>{var l=e.length;if(l<o)for(var m=o-l,b=0;b<m;b++)e.push({});else e.splice(o);var k=e.map((e,l)=>{var o=(Array.isArray(e.innerBlocks)?w(e.innerBlocks):[]).map(e=>{var t;return null===(t=e.attributes)||void 0===t?void 0:t.className}).filter(Boolean).map(e=>{var t,l=e.match(/sp_field_([\w-]+)|(tax_[\w-]+)/);return l?null!==(t=l[1])&&void 0!==t?t:l[2]:null}).filter(Boolean),i=[...t,...a.map(e=>({key:"tax_".concat(e),label:e,block:"itmar/design-title"}))].filter(e=>!o.includes(e.key)).map(e=>{var t,l=((e,t)=>{var l,a,o,n,i,s,c={};switch(e.block){case"itmar/design-title":c={className:e.key.startsWith("tax_")?e.key:"sp_field_".concat(e.key),headingContent:"[".concat(e.label,"]")};break;case"core/paragraph":c={className:"itmar_ex_block sp_field_".concat(e.key),content:"[".concat(e.label,"]")};break;case"core/image":c={className:"itmar_ex_block sp_field_".concat(e.key),url:"".concat(null===(l=window[t])||void 0===l?void 0:l.plugin_url,"/assets/image/main_sample.png")};break;case"itmar/slide-mv":var u=(0,r.createBlock)("core/image",y({className:"itmar_ex_block",url:"".concat(null===(a=window[t])||void 0===a?void 0:a.plugin_url,"/assets/image/slide_sample.png")},{margin_val:{type:"object",default:{top:"0em",left:"0em",bottom:"0em",right:"0em"}},padding_val:{type:"object",default:{top:"0em",left:"0em",bottom:"0em",right:"0em"}}})),d=(0,r.getBlockType)("itmar/design-group"),m=null!==(o=null==d||null===(n=d.attributes)||void 0===n||null===(n=n.default_val)||void 0===n?void 0:n.default)&&void 0!==o?o:{},b=null!==(i=null==d||null===(s=d.attributes)||void 0===s||null===(s=s.mobile_val)||void 0===s?void 0:s.default)&&void 0!==i?i:{},k=(0,r.createBlock)("itmar/design-group",{default_val:y(y({},m),{},{width_val:"fit"}),mobile_val:y(y({},b),{},{width_val:"fit"})},[u]),p=x(k),_=Array.from({length:5},()=>j(p));c={attributes:{className:"sp_field_".concat(e.key)},slideBlocks:_};break;default:c={className:"sp_field_".concat(e.key),headingContent:"[".concat(e.label,"]")}}return c})(e,c),a=e.block,o=null!==(t=null==l?void 0:l.attributes)&&void 0!==t?t:l,n=Array.isArray(null==l?void 0:l.slideBlocks)?l.slideBlocks:[];return(0,r.createBlock)(a,o,n)}),s=t.map(e=>e.key),u=e=>e.map(e=>{var t,l=(null===(t=e.attributes)||void 0===t?void 0:t.className)||"",r=l.match(/sp_field_([a-zA-Z0-9_]+)/);if(l.startsWith("tax_")){var o=l.slice(4);a.includes(o)||(r=["tax_".concat(o),o])}var n=e.innerBlocks?u(e.innerBlocks):[];return!r||s.includes(r[1])?y(y({},e),{},{innerBlocks:n}):null}).filter(Boolean),d=[...Array.isArray(e.innerBlocks)?u(e.innerBlocks).map(j):[],...i];return(0,r.createBlock)("itmar/design-group",y(y({},e.attributes),{},{className:"unit_design_".concat(l),domType:n}),d)});s!==i&&k.push(d),u(s,k,!1)},[t,l,a])})(T,S,"product",M,4,R,l,H,"itmaroon_ec_relate_blocks");const J=(0,k.useRef)("");(0,k.useEffect)(()=>{if(!U||0===U.length)return;const e=U.map(x),l=JSON.stringify(e);l!==J.current&&(J.current=l,t({blocksAttributesArray:e}))},[U,t]);const[L,W]=(0,k.useState)(i),[q,z]=(0,k.useState)(O),[Q,V]=(0,k.useState)(s),[K,X]=(0,k.useState)(_),[Z,$]=(0,k.useState)(g),[G,Y]=(0,k.useState)(h),[ee,te]=(0,k.useState)(f),[le,ae]=(0,k.useState)(null),[re,oe]=(0,k.useState)(!1),[ne,ie]=(0,k.useState)([]),[se,ce]=(0,k.useState)(""),[ue,de]=(0,k.useState)(""),[me,be]=(0,k.useState)("");return(0,k.useEffect)(()=>{!async function(){const e={productPost:n,shop_domain:i,channel_name:_,api_secret:se,admin_token:ue,storefront_token:me,stripe_key:P},t=await fetch("/wp-json/itmar-ec-relate/v1/settings/save",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":itmar_option.nonce},credentials:"include",body:JSON.stringify(e)}),l=await t.json();"ok"===l.status?console.log("保存成功"):console.error("保存失敗",l)}()},[i,se,ue,me,P,n]),(0,k.useEffect)(()=>{let e=!0;return(async()=>{try{const l=await c()({path:"/itmar-ec-relate/v1/get-collections"});if(!e)return;const a=Array.isArray(l)?l:[];t({categoryArray:a})}catch(e){}})(),()=>{e=!1}},[]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.InspectorControls,{children:(0,d.jsxs)(u.PanelBody,{title:(0,a.__)("EC setting","itmaroon-ec-relate-blocks"),children:[(0,d.jsx)(u.TextControl,{label:(0,a.__)("Pickup ID","itmaroon-ec-relate-blocks"),value:o,onChange:e=>t({pickupId:e})}),(0,d.jsx)(C,{selectedSlug:n,label:(0,a.__)("Select Product Post Type","itmaroon-ec-relate-blocks"),homeUrl:itmar_option.home_url,onChange:e=>{e&&t({productPost:e.slug})}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Store Site URL","itmaroon-ec-relate-blocks"),value:L,onChange:e=>W(e),onBlur:()=>{t({storeUrl:L})}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Shop ID","itmaroon-ec-relate-blocks"),value:Q,onChange:e=>V(e),onBlur:()=>{t({shopId:Q})}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Channel Name","itmaroon-ec-relate-blocks"),value:K,onChange:e=>X(e),onBlur:()=>{t({channelName:K})}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Headless Client ID","itmaroon-ec-relate-blocks"),value:Z,onChange:e=>$(e),onBlur:()=>{t({headlessId:Z})}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("API Secret","itmaroon-ec-relate-blocks"),value:G,onChange:e=>Y(e),onBlur:()=>{t({apiSecretMask:"********"}),ce(G)}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Admin API Token","itmaroon-ec-relate-blocks"),value:ee,onChange:e=>te(e),onBlur:()=>{t({adminTokenMask:"********"}),de(ee)}}),(0,d.jsx)(u.TextControl,{label:(0,a.__)("Storefront API Token","itmaroon-ec-relate-blocks"),value:q,onChange:e=>z(e),onBlur:()=>{t({storefrontTokenMask:"**********"}),be(q)}}),(0,d.jsx)(m,{fieldType:"product",selectedFields:S,setSelectedFields:e=>t({selectedFields:e})}),(0,d.jsx)(u.PanelRow,{className:"itmar_post_blocks_pannel",children:(0,d.jsx)(u.RangeControl,{value:A,label:(0,a.__)("Display Num","itmaroon-ec-relate-blocks"),max:30,min:1,onChange:e=>t({numberOfItems:e})})})]})}),(0,d.jsx)(b.InspectorControls,{group:"styles",children:(0,d.jsx)(u.PanelBody,{title:(0,a.__)("Unit Style Copy&Past","itmaroon-ec-relate-blocks"),children:(0,d.jsx)("div",{className:"itmar_post_block_notice",children:T.map((e,r)=>{const o={label:(0,a.__)("Copy","itmaroon-ec-relate-blocks"),onClick:()=>{ae(r)}},n={label:re?(0,d.jsx)("img",{src:`${itmar_option.plugin_url}/assets/past-wait.gif`,alt:(0,a.__)("wait","itmaroon-ec-relate-blocks"),style:{width:"36px",height:"36px"}}):(0,a.__)("Paste","itmaroon-ec-relate-blocks"),onClick:()=>{if(oe(!0),null!==le){const e=[...T],a=[...U];ne.forEach((t,l)=>{if(t){const t=j(T[le]);a[l]=t,e[l]=T[le]}}),I(l,a,!1),t({blocksAttributesArray:e}),oe(!1),ae(null),ie(Array(T.length).fill(!1))}}},i=le===r?[n]:[o],s=(0,a.__)("Check the unit to which you want to paste and press the Paste button.","itmaroon-ec-relate-blocks"),c=le!=r?(0,d.jsx)(u.CheckboxControl,{label:(0,a.__)("Paste to","itmaroon-ec-relate-blocks"),checked:ne[r],onChange:e=>{((e,t)=>{const l=[...ne];l[e]=t,ie(l)})(r,e)}}):(0,d.jsx)("p",{children:s});return(0,d.jsxs)("div",{className:"style_unit",children:[(0,d.jsx)(u.Notice,{actions:i,status:le===r?"success":"default",isDismissible:!1,children:(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{children:`Unit ${r+1} Style`}),(0,d.jsx)("p",{children:N[r]})]})},r),(0,d.jsx)("div",{className:"past_state",children:c})]})})})})}),(0,d.jsx)("div",{...F})]})},save:function({attributes:e}){const{pickupId:t,shopId:l,headlessId:a,numberOfItems:r,selectedFields:o}=e;return(0,d.jsx)("div",{...b.useBlockProps.save(),"data-pickup_id":t,"data-shop_id":l,"data-headless_id":a,"data-number_of_items":r,"data-selected_slug":"product_category","data-selected_fields":JSON.stringify(o),children:(0,d.jsx)("div",{className:"template_unit unit_hide",children:(0,d.jsx)(b.InnerBlocks.Content,{})})})}})}},l={};function a(e){var r=l[e];if(void 0!==r)return r.exports;var o=l[e]={exports:{}};return t[e](o,o.exports,a),o.exports}a.m=t,e=[],a.O=(t,l,r,o)=>{if(!l){var n=1/0;for(u=0;u<e.length;u++){for(var[l,r,o]=e[u],i=!0,s=0;s<l.length;s++)(!1&o||n>=o)&&Object.keys(a.O).every(e=>a.O[e](l[s]))?l.splice(s--,1):(i=!1,o<n&&(n=o));if(i){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[l,r,o]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={521:0,133:0};a.O.j=t=>0===e[t];var t=(t,l)=>{var r,o,[n,i,s]=l,c=0;if(n.some(t=>0!==e[t])){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(s)var u=s(a)}for(t&&t(l);c<n.length;c++)o=n[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(u)},l=globalThis.webpackChunkitmaroon_ec_relate_bloks=globalThis.webpackChunkitmaroon_ec_relate_bloks||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))})();var r=a.O(void 0,[133],()=>a(945));r=a.O(r)})();